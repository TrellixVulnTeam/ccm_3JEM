{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport \"antd/lib/config-provider/style\";\nimport _ConfigProvider from \"antd/lib/config-provider\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useEffect, useState } from 'react';\nimport { getCookies, setCookie } from './cookie';\nimport zh_CN from 'antd/lib/locale/zh_CN';\nimport enUS from 'antd/lib/locale/en_US';\nimport enLang from 'react-intl/locale-data/en';\nimport zhLang from 'react-intl/locale-data/zh';\nimport { IntlProvider, addLocaleData } from 'react-intl';\nimport zh from '../utils/lang/zh';\nimport en from '../utils/lang/en';\nimport ContextProvider from '../reducer';\nimport { isMobile, parseQueryString } from './common';\nimport Router from 'next/router';\naddLocaleData([].concat(_toConsumableArray(enLang), _toConsumableArray(zhLang)));\nexport var withAuthSync = function withAuthSync(WrappedComponent) {\n  var Wrapper = function Wrapper(props) {\n    var handleGetLang = function handleGetLang() {\n      if (props.language === 'en') {\n        return 'en';\n      } else {\n        return 'zh';\n      }\n    };\n\n    var _useState = useState(handleGetLang()),\n        lang = _useState[0],\n        setLang = _useState[1];\n\n    var handleLang = function handleLang(la, isAnt) {\n      switch (la) {\n        case 'en':\n          if (isAnt) {\n            return enUS;\n          } else {\n            return en;\n          }\n\n        default:\n          if (isAnt) {\n            return zh_CN;\n          } else {\n            return zh;\n          }\n\n      }\n    };\n\n    useEffect(function () {\n      // 兼容之前的hash 地址\n      handlePath();\n\n      if (props.lang) {\n        setCookie('lang', props.lang, 365);\n      }\n\n      window.handleChangeLang = function (type) {\n        setCookie('lang', type, 365);\n        setLang(type);\n      };\n\n      var lastTouchEnd = 0;\n      document.addEventListener('touchstart', function (event) {\n        if (event.touches.length > 1) {\n          event.preventDefault();\n        }\n      });\n      document.addEventListener('touchend', function (event) {\n        var now = new Date().getTime();\n\n        if (now - lastTouchEnd <= 300) {\n          event.preventDefault();\n        }\n\n        lastTouchEnd = now;\n      }, false); // 阻止双指放大\n\n      document.addEventListener('gesturestart', function (event) {\n        event.preventDefault();\n      }); // dispatch({ type: 'SET_WINDOW', data: window.innerWidth })\n\n      return function () {\n        window.handleChangeLang = null;\n      };\n    }, []);\n\n    var handlePath = function handlePath() {\n      var _window$location = window.location,\n          href = _window$location.href,\n          hash = _window$location.hash;\n\n      if (hash.startsWith('#/hashsearch?id=')) {\n        var id = parseQueryString(href).id;\n        location.href = \"/hash/\".concat(id);\n      } else if (hash.startsWith('#/addresssearch?id=')) {\n        var _id = parseQueryString(href).id;\n        location.href = \"/addr/\".concat(_id);\n      }\n    };\n\n    return __jsx(_ConfigProvider, {\n      locale: handleLang(lang, true)\n    }, __jsx(IntlProvider, {\n      locale: lang,\n      messages: handleLang(lang, false)\n    }, __jsx(ContextProvider, {\n      mobile: props.mobile\n    }, __jsx(WrappedComponent, _extends({}, props, {\n      language: props.language\n    })))));\n  };\n\n  Wrapper.getInitialProps = function _callee(ctx) {\n    var _ctx$router$asPath, _ctx$ctx$res;\n\n    var componentProps, language, lang, mobile;\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!((_ctx$router$asPath = ctx.router.asPath) === null || _ctx$router$asPath === void 0 ? void 0 : _ctx$router$asPath.startsWith('/_next/static')) && ((_ctx$ctx$res = ctx.ctx.res) === null || _ctx$ctx$res === void 0 ? void 0 : _ctx$ctx$res.statusCode) === 404) {\n              ctx.ctx.res.writeHead(302, {\n                Location: '/'\n              });\n              ctx.ctx.res.end();\n            }\n\n            _context.t0 = WrappedComponent.getInitialProps;\n\n            if (!_context.t0) {\n              _context.next = 6;\n              break;\n            }\n\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(WrappedComponent.getInitialProps(ctx));\n\n          case 5:\n            _context.t0 = _context.sent;\n\n          case 6:\n            componentProps = _context.t0;\n            lang = '';\n            mobile = false ? isMobile(ctx.ctx.req.headers['user-agent']) : isMobile(window.navigator.userAgent);\n\n            if (ctx.ctx.query.lang) {\n              language = ctx.ctx.query.lang === 'en' ? 'en' : 'zh';\n              lang = language;\n            } else {\n              language = getCookies(ctx.ctx.req)['lang'] || 'zh';\n            }\n\n            ctx.ctx.language = language;\n            return _context.abrupt(\"return\", _objectSpread({}, componentProps, {\n              language: language,\n              lang: lang,\n              mobile: mobile\n            }));\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return Wrapper;\n};","map":null,"metadata":{},"sourceType":"module"}