{"ast":null,"code":"import \"antd/lib/config-provider/style\";\nimport _ConfigProvider from \"antd/lib/config-provider\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport { useEffect, useState } from 'react';\nimport { getCookies, setCookie } from './cookie';\nimport zh_CN from 'antd/lib/locale/zh_CN';\nimport enUS from 'antd/lib/locale/en_US';\nimport enLang from 'react-intl/locale-data/en';\nimport zhLang from 'react-intl/locale-data/zh';\nimport { IntlProvider, addLocaleData } from 'react-intl';\nimport zh from '../utils/lang/zh';\nimport en from '../utils/lang/en';\nimport ContextProvider from '../reducer';\nimport { isMobile, parseQueryString } from './common';\nimport Router from 'next/router';\naddLocaleData([...enLang, ...zhLang]);\nexport const withAuthSync = WrappedComponent => {\n  const Wrapper = props => {\n    const handleGetLang = () => {\n      if (props.language === 'en') {\n        return 'en';\n      } else {\n        return 'zh';\n      }\n    };\n\n    const {\n      0: lang,\n      1: setLang\n    } = useState(handleGetLang());\n\n    const handleLang = (la, isAnt) => {\n      switch (la) {\n        case 'en':\n          if (isAnt) {\n            return enUS;\n          } else {\n            return en;\n          }\n\n        default:\n          if (isAnt) {\n            return zh_CN;\n          } else {\n            return zh;\n          }\n\n      }\n    };\n\n    useEffect(() => {\n      // 兼容之前的hash 地址\n      handlePath();\n\n      if (props.lang) {\n        setCookie('lang', props.lang, 365);\n      }\n\n      window.handleChangeLang = type => {\n        setCookie('lang', type, 365);\n        setLang(type);\n      };\n\n      var lastTouchEnd = 0;\n      document.addEventListener('touchstart', function (event) {\n        if (event.touches.length > 1) {\n          event.preventDefault();\n        }\n      });\n      document.addEventListener('touchend', event => {\n        var now = new Date().getTime();\n\n        if (now - lastTouchEnd <= 300) {\n          event.preventDefault();\n        }\n\n        lastTouchEnd = now;\n      }, false); // 阻止双指放大\n\n      document.addEventListener('gesturestart', function (event) {\n        event.preventDefault();\n      }); // dispatch({ type: 'SET_WINDOW', data: window.innerWidth })\n\n      return () => {\n        window.handleChangeLang = null;\n      };\n    }, []);\n\n    const handlePath = () => {\n      const {\n        href,\n        hash\n      } = window.location;\n\n      if (hash.startsWith('#/hashsearch?id=')) {\n        const id = parseQueryString(href).id;\n        location.href = `/hash/${id}`;\n      } else if (hash.startsWith('#/addresssearch?id=')) {\n        const id = parseQueryString(href).id;\n        location.href = `/addr/${id}`;\n      }\n    };\n\n    return __jsx(_ConfigProvider, {\n      locale: handleLang(lang, true)\n    }, __jsx(IntlProvider, {\n      locale: lang,\n      messages: handleLang(lang, false)\n    }, __jsx(ContextProvider, {\n      mobile: props.mobile\n    }, __jsx(WrappedComponent, _extends({}, props, {\n      language: props.language\n    })))));\n  };\n\n  Wrapper.getInitialProps = async ctx => {\n    var _ctx$router$asPath, _ctx$ctx$res;\n\n    if (!((_ctx$router$asPath = ctx.router.asPath) === null || _ctx$router$asPath === void 0 ? void 0 : _ctx$router$asPath.startsWith('/_next/static')) && ((_ctx$ctx$res = ctx.ctx.res) === null || _ctx$ctx$res === void 0 ? void 0 : _ctx$ctx$res.statusCode) === 404) {\n      ctx.ctx.res.writeHead(302, {\n        Location: '/'\n      });\n      ctx.ctx.res.end();\n    }\n\n    const componentProps = WrappedComponent.getInitialProps && (await WrappedComponent.getInitialProps(ctx));\n    let language;\n    let lang = '';\n    const mobile = true ? isMobile(ctx.ctx.req.headers['user-agent']) : isMobile(window.navigator.userAgent);\n\n    if (ctx.ctx.query.lang) {\n      language = ctx.ctx.query.lang === 'en' ? 'en' : 'zh';\n      lang = language;\n    } else {\n      language = getCookies(ctx.ctx.req)['lang'] || 'zh';\n    }\n\n    ctx.ctx.language = language;\n    return _objectSpread({}, componentProps, {\n      language,\n      lang,\n      mobile\n    });\n  };\n\n  return Wrapper;\n};","map":{"version":3,"sources":["/Users/libaozhong/cr/ccm-front/utils/auth.js"],"names":["useEffect","useState","getCookies","setCookie","zh_CN","enUS","enLang","zhLang","IntlProvider","addLocaleData","zh","en","ContextProvider","isMobile","parseQueryString","Router","withAuthSync","WrappedComponent","Wrapper","props","handleGetLang","language","lang","setLang","handleLang","la","isAnt","handlePath","window","handleChangeLang","type","lastTouchEnd","document","addEventListener","event","touches","length","preventDefault","now","Date","getTime","href","hash","location","startsWith","id","mobile","getInitialProps","ctx","router","asPath","res","statusCode","writeHead","Location","end","componentProps","req","headers","navigator","userAgent","query"],"mappings":";;;;;;;;;;;;;AAAA,SAASA,SAAT,EAAoBC,QAApB,QAAoC,OAApC;AACA,SAASC,UAAT,EAAqBC,SAArB,QAAsC,UAAtC;AACA,OAAOC,KAAP,MAAkB,uBAAlB;AACA,OAAOC,IAAP,MAAiB,uBAAjB;AAEA,OAAOC,MAAP,MAAmB,2BAAnB;AACA,OAAOC,MAAP,MAAmB,2BAAnB;AACA,SAASC,YAAT,EAAuBC,aAAvB,QAA4C,YAA5C;AACA,OAAOC,EAAP,MAAe,kBAAf;AACA,OAAOC,EAAP,MAAe,kBAAf;AACA,OAAOC,eAAP,MAA4B,YAA5B;AACA,SAASC,QAAT,EAAmBC,gBAAnB,QAA2C,UAA3C;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACAN,aAAa,CAAC,CAAC,GAAGH,MAAJ,EAAY,GAAGC,MAAf,CAAD,CAAb;AAEA,OAAO,MAAMS,YAAY,GAAIC,gBAAD,IAAsB;AAChD,QAAMC,OAAO,GAAIC,KAAD,IAAW;AACzB,UAAMC,aAAa,GAAG,MAAM;AAC1B,UAAID,KAAK,CAACE,QAAN,KAAmB,IAAvB,EAA6B;AAC3B,eAAO,IAAP;AACD,OAFD,MAEO;AACL,eAAO,IAAP;AACD;AACF,KAND;;AAOA,UAAM;AAAA,SAACC,IAAD;AAAA,SAAOC;AAAP,QAAkBtB,QAAQ,CAACmB,aAAa,EAAd,CAAhC;;AACA,UAAMI,UAAU,GAAG,CAACC,EAAD,EAAKC,KAAL,KAAe;AAChC,cAAQD,EAAR;AACE,aAAK,IAAL;AACE,cAAIC,KAAJ,EAAW;AACT,mBAAOrB,IAAP;AACD,WAFD,MAEO;AACL,mBAAOM,EAAP;AACD;;AACH;AACE,cAAIe,KAAJ,EAAW;AACT,mBAAOtB,KAAP;AACD,WAFD,MAEO;AACL,mBAAOM,EAAP;AACD;;AAZL;AAcD,KAfD;;AAiBAV,IAAAA,SAAS,CAAC,MAAM;AACd;AACA2B,MAAAA,UAAU;;AAEV,UAAIR,KAAK,CAACG,IAAV,EAAgB;AACdnB,QAAAA,SAAS,CAAC,MAAD,EAASgB,KAAK,CAACG,IAAf,EAAqB,GAArB,CAAT;AACD;;AAEDM,MAAAA,MAAM,CAACC,gBAAP,GAA2BC,IAAD,IAAU;AAClC3B,QAAAA,SAAS,CAAC,MAAD,EAAS2B,IAAT,EAAe,GAAf,CAAT;AACAP,QAAAA,OAAO,CAACO,IAAD,CAAP;AACD,OAHD;;AAKA,UAAIC,YAAY,GAAG,CAAnB;AACAC,MAAAA,QAAQ,CAACC,gBAAT,CAA0B,YAA1B,EAAwC,UAAUC,KAAV,EAAiB;AACvD,YAAIA,KAAK,CAACC,OAAN,CAAcC,MAAd,GAAuB,CAA3B,EAA8B;AAC5BF,UAAAA,KAAK,CAACG,cAAN;AACD;AACF,OAJD;AAKAL,MAAAA,QAAQ,CAACC,gBAAT,CACE,UADF,EAEGC,KAAD,IAAW;AACT,YAAII,GAAG,GAAG,IAAIC,IAAJ,GAAWC,OAAX,EAAV;;AACA,YAAIF,GAAG,GAAGP,YAAN,IAAsB,GAA1B,EAA+B;AAC7BG,UAAAA,KAAK,CAACG,cAAN;AACD;;AACDN,QAAAA,YAAY,GAAGO,GAAf;AACD,OARH,EASE,KATF,EAnBc,CA8Bd;;AACAN,MAAAA,QAAQ,CAACC,gBAAT,CAA0B,cAA1B,EAA0C,UAAUC,KAAV,EAAiB;AACzDA,QAAAA,KAAK,CAACG,cAAN;AACD,OAFD,EA/Bc,CAkCd;;AACA,aAAO,MAAM;AACXT,QAAAA,MAAM,CAACC,gBAAP,GAA0B,IAA1B;AACD,OAFD;AAGD,KAtCQ,EAsCN,EAtCM,CAAT;;AAwCA,UAAMF,UAAU,GAAG,MAAM;AACvB,YAAM;AAAEc,QAAAA,IAAF;AAAQC,QAAAA;AAAR,UAAiBd,MAAM,CAACe,QAA9B;;AACA,UAAID,IAAI,CAACE,UAAL,CAAgB,kBAAhB,CAAJ,EAAyC;AACvC,cAAMC,EAAE,GAAG/B,gBAAgB,CAAC2B,IAAD,CAAhB,CAAuBI,EAAlC;AACAF,QAAAA,QAAQ,CAACF,IAAT,GAAiB,SAAQI,EAAG,EAA5B;AACD,OAHD,MAGO,IAAIH,IAAI,CAACE,UAAL,CAAgB,qBAAhB,CAAJ,EAA4C;AACjD,cAAMC,EAAE,GAAG/B,gBAAgB,CAAC2B,IAAD,CAAhB,CAAuBI,EAAlC;AACAF,QAAAA,QAAQ,CAACF,IAAT,GAAiB,SAAQI,EAAG,EAA5B;AACD;AACF,KATD;;AAWA,WACE;AAAgB,MAAA,MAAM,EAAErB,UAAU,CAACF,IAAD,EAAO,IAAP;AAAlC,OACE,MAAC,YAAD;AAAc,MAAA,MAAM,EAAEA,IAAtB;AAA4B,MAAA,QAAQ,EAAEE,UAAU,CAACF,IAAD,EAAO,KAAP;AAAhD,OACE,MAAC,eAAD;AAAiB,MAAA,MAAM,EAAEH,KAAK,CAAC2B;AAA/B,OACE,MAAC,gBAAD,eAAsB3B,KAAtB;AAA6B,MAAA,QAAQ,EAAEA,KAAK,CAACE;AAA7C,OADF,CADF,CADF,CADF;AASD,GAtFD;;AAwFAH,EAAAA,OAAO,CAAC6B,eAAR,GAA0B,MAAOC,GAAP,IAAe;AAAA;;AACvC,QAAI,wBAACA,GAAG,CAACC,MAAJ,CAAWC,MAAZ,uDAAC,mBAAmBN,UAAnB,CAA8B,eAA9B,CAAD,KAAmD,iBAAAI,GAAG,CAACA,GAAJ,CAAQG,GAAR,8DAAaC,UAAb,MAA4B,GAAnF,EAAwF;AACtFJ,MAAAA,GAAG,CAACA,GAAJ,CAAQG,GAAR,CAAYE,SAAZ,CAAsB,GAAtB,EAA2B;AAAEC,QAAAA,QAAQ,EAAE;AAAZ,OAA3B;AACAN,MAAAA,GAAG,CAACA,GAAJ,CAAQG,GAAR,CAAYI,GAAZ;AACD;;AACD,UAAMC,cAAc,GAAGvC,gBAAgB,CAAC8B,eAAjB,KAAqC,MAAM9B,gBAAgB,CAAC8B,eAAjB,CAAiCC,GAAjC,CAA3C,CAAvB;AACA,QAAI3B,QAAJ;AACA,QAAIC,IAAI,GAAG,EAAX;AACA,UAAMwB,MAAM,GAAG,OAAgCjC,QAAQ,CAACmC,GAAG,CAACA,GAAJ,CAAQS,GAAR,CAAYC,OAAZ,CAAoB,YAApB,CAAD,CAAxC,GAA8E7C,QAAQ,CAACe,MAAM,CAAC+B,SAAP,CAAiBC,SAAlB,CAArG;;AACA,QAAIZ,GAAG,CAACA,GAAJ,CAAQa,KAAR,CAAcvC,IAAlB,EAAwB;AACtBD,MAAAA,QAAQ,GAAG2B,GAAG,CAACA,GAAJ,CAAQa,KAAR,CAAcvC,IAAd,KAAuB,IAAvB,GAA8B,IAA9B,GAAqC,IAAhD;AACAA,MAAAA,IAAI,GAAGD,QAAP;AACD,KAHD,MAGO;AACLA,MAAAA,QAAQ,GAAGnB,UAAU,CAAC8C,GAAG,CAACA,GAAJ,CAAQS,GAAT,CAAV,CAAwB,MAAxB,KAAmC,IAA9C;AACD;;AACDT,IAAAA,GAAG,CAACA,GAAJ,CAAQ3B,QAAR,GAAmBA,QAAnB;AACA,6BAAYmC,cAAZ;AAA4BnC,MAAAA,QAA5B;AAAsCC,MAAAA,IAAtC;AAA4CwB,MAAAA;AAA5C;AACD,GAjBD;;AAmBA,SAAO5B,OAAP;AACD,CA7GM","sourcesContent":["import { useEffect, useState } from 'react'\nimport { getCookies, setCookie } from './cookie'\nimport zh_CN from 'antd/lib/locale/zh_CN'\nimport enUS from 'antd/lib/locale/en_US'\nimport { ConfigProvider } from 'antd'\nimport enLang from 'react-intl/locale-data/en'\nimport zhLang from 'react-intl/locale-data/zh'\nimport { IntlProvider, addLocaleData } from 'react-intl'\nimport zh from '../utils/lang/zh'\nimport en from '../utils/lang/en'\nimport ContextProvider from '../reducer'\nimport { isMobile, parseQueryString } from './common'\nimport Router from 'next/router'\naddLocaleData([...enLang, ...zhLang])\n\nexport const withAuthSync = (WrappedComponent) => {\n  const Wrapper = (props) => {\n    const handleGetLang = () => {\n      if (props.language === 'en') {\n        return 'en'\n      } else {\n        return 'zh'\n      }\n    }\n    const [lang, setLang] = useState(handleGetLang())\n    const handleLang = (la, isAnt) => {\n      switch (la) {\n        case 'en':\n          if (isAnt) {\n            return enUS\n          } else {\n            return en\n          }\n        default:\n          if (isAnt) {\n            return zh_CN\n          } else {\n            return zh\n          }\n      }\n    }\n\n    useEffect(() => {\n      // 兼容之前的hash 地址\n      handlePath()\n\n      if (props.lang) {\n        setCookie('lang', props.lang, 365)\n      }\n\n      window.handleChangeLang = (type) => {\n        setCookie('lang', type, 365)\n        setLang(type)\n      }\n\n      var lastTouchEnd = 0\n      document.addEventListener('touchstart', function (event) {\n        if (event.touches.length > 1) {\n          event.preventDefault()\n        }\n      })\n      document.addEventListener(\n        'touchend',\n        (event) => {\n          var now = new Date().getTime()\n          if (now - lastTouchEnd <= 300) {\n            event.preventDefault()\n          }\n          lastTouchEnd = now\n        },\n        false\n      )\n      // 阻止双指放大\n      document.addEventListener('gesturestart', function (event) {\n        event.preventDefault()\n      })\n      // dispatch({ type: 'SET_WINDOW', data: window.innerWidth })\n      return () => {\n        window.handleChangeLang = null\n      }\n    }, [])\n\n    const handlePath = () => {\n      const { href, hash } = window.location\n      if (hash.startsWith('#/hashsearch?id=')) {\n        const id = parseQueryString(href).id\n        location.href = `/hash/${id}`\n      } else if (hash.startsWith('#/addresssearch?id=')) {\n        const id = parseQueryString(href).id\n        location.href = `/addr/${id}`\n      }\n    }\n\n    return (\n      <ConfigProvider locale={handleLang(lang, true)}>\n        <IntlProvider locale={lang} messages={handleLang(lang, false)}>\n          <ContextProvider mobile={props.mobile}>\n            <WrappedComponent {...props} language={props.language} />\n          </ContextProvider>\n        </IntlProvider>\n      </ConfigProvider>\n    )\n  }\n\n  Wrapper.getInitialProps = async (ctx) => {\n    if (!ctx.router.asPath?.startsWith('/_next/static') && ctx.ctx.res?.statusCode === 404) {\n      ctx.ctx.res.writeHead(302, { Location: '/' })\n      ctx.ctx.res.end()\n    }\n    const componentProps = WrappedComponent.getInitialProps && (await WrappedComponent.getInitialProps(ctx))\n    let language\n    let lang = ''\n    const mobile = typeof window === 'undefined' ? isMobile(ctx.ctx.req.headers['user-agent']) : isMobile(window.navigator.userAgent)\n    if (ctx.ctx.query.lang) {\n      language = ctx.ctx.query.lang === 'en' ? 'en' : 'zh'\n      lang = language\n    } else {\n      language = getCookies(ctx.ctx.req)['lang'] || 'zh'\n    }\n    ctx.ctx.language = language\n    return { ...componentProps, language, lang, mobile }\n  }\n\n  return Wrapper\n}\n"]},"metadata":{},"sourceType":"module"}